CC ?= gcc
CFLAGS ?= -O2 -g -Wall -Wextra
LDFLAG ?= 

SRCS := Attacker.c Victim.c
BINS := CVE-2016-10229-Attacker CVE-2016-10229-Victim

.PHONY: all clean debug run-victim run-attacker

all: $(BINS)

CVE-2016-10229-Attacker: Attacker.c
	$(CC) $(CFLAGS) $< -o $@ $(LDFLAGS)

CVE-2016-10229-Victim: Victim.c
	$(CC) $(CFLAGS) $< -o $@ $(LDFLAGS)

debug:
	$(MAKE) CFLAGS="-O0 -g -Wall -Wextra -fsanitize=address,undefined" LDFLAGS="-fsanitize=address,undefined" all

run-victim: CVE-2016-10299-Victim
	./CVE-2016-10299-Victim

run-attacker: CVE-2016-10299-Attacker
	./CVE-2016-10299-Attacker

clean:
	-rm -f $(BINS) *.o core

