#include <sys/socket.h>
#include <stdio.h>
#include <stdlib.h>
#include <errno.h>
#include <unistd.h>
#include <arpa/inet.h>
#include <time.h>
#include <string.h>

#define MAX_SIZE 1500
#define DELAY_TIME 100

int main(int argc, char* argv[]){

	if(argc != 3){

		printf("Invalid amount of arguments!\n\nUsage: %s <victim_ip> <victim_port>\n\n", argv[0]);

		return 1;
	}

	const char *victim = argv[1];
	int port = atoi(argv[2]);

	int sock_fd = socket(AF_INET, SOCK_DGRAM, 0);

	if(sock_fd < 0){

		perror("Socket Fail");
		return 1;

	}

	struct sockaddr_in addr;
	memset(&addr, 0, sizeof(addr));
	addr.sin_family = AF_INET;
	addr.sin_port = htons(port);

	if(inet_pton(AF_INET, victim, &addr.sin_addr) <= 0){

		perror("IP Fail");
		return 1;

	}

	printf("Fuzzing victim machine at %s port %d paylaods 1-1500 bytes", victim, port);

	srand(time(NULL));
	for (int size = 1; size <= MAX_SIZE; size += 16){

		char *payload = malloc(size);

		if(!payload){

			perror("Malloc Fail");
			break;

		}

		for(int i = 0; i < size; i++){

			payload[i] = (char)('A' + (i % 26));

		}

		ssize_t sent = sendto(sock_fd,payload,size,0,(struct sockaddr *)&addr, sizeof(addr));

		if(sent < 0){

			perror("Send Error");

		}else{

			printf("Sent Payload size=%zd\n",sent);

		}

		free(payload);
		usleep(DELAY_TIME * 1000);

	}

	close(sock_fd);

	return 0;

}

